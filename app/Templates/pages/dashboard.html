{% extends 'layout.html'%}

{% block content %}
{% load filters %}
<div id='dashboard-wrapper' ng-controller="DashBoardCtrl"
    ng-init="numOfPosts='{{ numOfPosts }}';
             feed_starts = {{ feed_starts }}"
    layout='row' layout-align='end'>
  
  <!-- Side navigation bar -->
  {% include 'pages/components/sidebar.html'%}
  <!-- END: Side navigation bar -->
  
  <div flex-gt-md="80">
    <!-- Main interface -->
    <!-- Create item and post button -->
    <div trigger style='position:fixed;top:100px;right:20px;z-index:1'>
      <md-button class="md-fab" aria-label="New document"
          ng-click="create_item()">
        <i class="fa fa-plus" style='font-size:20px;line-height:50px;'></i>
      </md-button>
      &nbsp;
      <a href="/app/post/">
        <md-button class="md-fab" aria-label="New document">
          <i class="fa fa-align-left" style='font-size:20px;line-height:50px;'></i>
        </md-button>
      </a>
    </div>

    <!-- Welcome message -->
    <div layout='row' layout-sm='column' layout-align='start center'>
      <div class='section-title section-title-exlarge'>Welcome,
      {{ request.user.profile.all.last.name }}
      </div>
    </div>

    <!-- News Feed section -->
    <div ng-show="layout.display_tab == 'feeds'"
        infinite-scroll="load_feeds()" infinite-scroll-distance="1"
        infinite-scroll-disabled="layout.display_tab !='feeds' || layout.loading.feeds || scrollTop < 200">
      <div infinit  flex-gt-md="90" flex>
      {% for record in feeds %}
      {%   with post=record%}
      {%     if post.model_name == 'Post' %}
        <div layout='row' class="event">
          <div flex='20' style='margin-top:20px;text-align:right'>
            {{ post.time_posted }}
          </div>
          <div flex>
      {%       include 'pages/components/post-overview.html'%}
          </div>
        </div>
      {%     endif %}
      {%   endwith %}
      {%   with event=record %}
      {%     if event.model_name == 'ItemEditRecord' %}
        <div layout='row'>
          <div flex="20" style='margin-top:20px;text-align:right'>
            {{ event.time_updated }}
          </div>
          <div flex>
            {%       include 'pages/components/django-item-update.html' %}
          </div>
        </div>
      {%     endif %}
      {%   endwith%}
      {% endfor %}
        <div ng-repeat="record in feeds">
          <div>
            <switch ng-switch on="record.model_name">
              <switch ng-switch-when="Post" ng-init="post=record">
                <div layout='row'>
                  <div flex="20" style='margin-top:20px;text-align:right'
                      ng-bind="post.time_posted">
                  </div>
                  <div flex>
                    <post-overview></post-overview>
                  </div>
                </div>
              </switch>
              <switch ng-switch-when="ItemEditRecord" ng-init="event=record">
                <div layout='row'>
                  <div flex="20" style="margin-top:20px;text-align:right"
                      ng-bind="event.time_updated">
                  </div>
                  <div flex>
                    <angular-item-update></angular-item-update>
                  </div>
                </div>
              </switch>
            </switch>
          </div>
        </div>
      </div>
    </div>

    <!-- timeline -->
    <div ng-show='layout.display_tab == "timeline" '
        infinite-scroll="load_timeline()" infinite-scroll-distance="1"
        infinite-scroll-disabled="layout.display_tab !='timeline' || layout.loading.timeline || scrollTop < 200">
      {% for event in timeline %}
      {%  if event.model_name == 'ItemEditRecord' %}
      <div layout='row' flex-gt-md="90">
        <div flex='20' style='margin-top:20px;text-align:right'>
          {{ event.time_updated }}
        </div>
        <div flex>
          {% include 'pages/components/django-item-update.html' %}
        </div>
      </div>
      {%  elif event.model_name == 'ItemTransactionRecord' %}
      <div layout='row' flex-gt-md="90">
        <div flex="20" style='margin-top:20px;text-align:right'>
          {{ event.time_updated }}
        </div>
        <div flex>
          {% include 'pages/components/django-item-transaction.html' %}
        </div>
      </div>
      {%   endif %}
      {% endfor %}
        <div ng-repeat="record in timeline">
          <switch ng-switch on="record.model_name">
            <switch ng-switch-when="ItemEditRecord" ng-init='event=record'>
              <div layout='row' flex-gt-md="90">
                <div flex="20" style='margin-top:20px;text-align:right'
                    ng-bind="event.time_updated">
                </div>
                <div flex>
                  <angular-item-update></angular-item-update>
                </div>
              </div>
            </switch>
            <switch ng-switch-when="ItemTransactionRecord" ng-init="event=record">
              <angular-item-transaction></angular-item-transaction>
            </switch>
          </switch>
        </div>
    </div>

    <!-- Post list -->
    <div infinite-scroll="load_posts()" infinite-scroll-distance="1"
        infinite-scroll-disabled="layout.display_tab !='posts' || layout.loading.posts || scrollTop < 600"
        ng-show="layout.display_tab == 'posts'" layout='row'>
      <div flex-gt-md="80" flex>
      {% for post in posts %}
        <div>
        {% include 'pages/components/post-overview.html'%}
        </div>
      {% endfor %}
      </div>
    </div>

    <!-- Item list -->
    <div ng-show='layout.display_tab == "items" '>
      <div class="section-title-large">
        Your inventory
      </div>

      <div id='items-display' layout='column' layout-gt-md='row'>
        <div flex-gt-md="50" flex='100'>
          <dashboard-item-overview
            ng-repeat='item in items' ng-show="$even">
          </dashboard-item-overview>
        </div>
        <div flex-gt-md="50" flex='100'>
          <div ng-repeat='item in items' ng-show="$odd">
            <div ng-bind="item.title"></div>
            <dashboard-item-overview></dashboard-item-overview>
          </div>
        </div>
      </div>
      <div layout='row' layout-align='center'>
        <div class="button pagination" ng-click="items.prev_page()">Previous</div>
        <div class="button pagination" ng-click="items.next_page()">Next</div>
      </div>
    </div>

    
  </div>
</div>

{% endblock %}