{% extends 'layout.html' %}

{% block content %}
{% load markdown_deux_tags %}
<style type="text/css">
  .post-editor .post-detail{
    background:#f9f9f9;padding:20px;cursor:pointer;
    transition: all 0.2;border: 1px solid #ddd;
    -webkit-transition: all 0.2;
  }
  .post-editor .post-detail:hover{
    background: #f4f4f4;
  }
  .post-editor .post-detail:active{
    background: #eee;
  }
  .post-editor textarea{
    border: 1px solid #ddd;
  }
  input.submission-error.ng-invalid.ng-dirty{
    background: red;color: #fff;
  }
</style>

<form name='postEditor' class='post-editor' ng-controller="postCtrl" ng-cloak
    style='padding:20px;'
    {% if post.id %} ng-init="id={{ post.id }}" {% endif %}
    layout='row' layout-align='center'>
  <div flex-gt-md="80" flex>
    {% if not post %}
    <div class='section-title section-title-large'>
      <i class="fa fa-align-left"></i> &nbsp;New post
    </div>
    <br/>
    {% endif %}
    <div>
      <div class='text-small' style='color:#999'>Click to edit</div>
      <div auto-expand data='post.title' init-width="180px" min-size=1>
        <input type='text'
            style="font-size: 25px;padding-left:0px;border:none;line-height:40px;"
            ng-class="{'submission-error': submission_error}"
            ng-model="post.title" required
            ng-init="post.title = '{{post.title}}'"
            placeholder="Post title here">
      </div>
      <div layout='column' layout-gt-md='row'>  
        <div style='padding:10px;'>
          <div style='color:#999;margin-bottom:5px;border-color:transparent;'>Area (zip code) &nbsp;</div>
          <div>

            <input style='width:44px;padding:0px;font-weight:600' type='text'
                ng-model="post.area" 
                ng-class="{'submission-error': submission_error}"
                ng-init="post.area='{{ request.user.profile.all.0.primary_area}}'"
                required ng-maxlength="5" ng-minlength='5'>
          </div>
        </div>
        &nbsp;
        &nbsp;
        <div>
          <input-dropdown label="'Visible to'" flex
              choices="post.visibility_choices" data='post.visibility'>
          </input-dropdown>
        </div>
        &nbsp;
        &nbsp;
        <div style="padding:10px;" auto-expand data='post.secret_key' min-size="20" init-width="160px" ng-show='post.visibility == "Invitation"'>
          <div style='color:#999;margin-bottom:5px;border-color:transparent;'>
            Secret key
            <i class="fa fa-info-circle" tooltip-placement="bottom" tooltip="Invitation-only articles are only accessible via search with secret-key."></i>
          </div>
          <div>
            <i class="fa fa-key"></i>&nbsp;<input style='padding:0px;color:#666;font-weight:600' type='text'
                placeholder="4-50 characters"
                ng-model="post.secret_key"
                ng-maxlength="50" ng-minlength="4">
          </div>
        </div>
      </div>
    </div>
    <br/>
    
    <!-- ======== Tags ======== -->

    <div flex>
      <tags-input class="custom" ng-model='tags_input'
          placeholder='Tag your post!'>
      </tags-input>
    </div>

    <!-- ======== Detail ======== -->
    <div>
      <div class="post-detail" ng-show="!layout.detail_input"
          ng-click="show_detail_editor()">
        {{ post.detail|markdown }}
      </div>
      <div ng-show="layout.detail_input">
        <textarea ng-model='post.detail'
            placeholder="Post body goes here ... You can use the [ TAB ] key to indent.">
        </textarea>
        <br/>
        <div class='text-large' style='padding:10px 0px;'>Preview</div>
        <div marked="post.detail" style='padding:10px;background:#f4f4f4;border:1px solid ddd;'>
          
        </div>
      </div>
    </div>
    <!-- ======== Tags ======== -->

    <div flex>
      <tags-input class="custom" ng-model='tags_input'
          placeholder='Tag your post!'>
      </tags-input>
    </div>

    <div>
      {% for item in items %}
      <div style='display:inline-block;margin-top:5px;margin-bottom:5px;'>
        {% include 'django-item-overview.html'%}
      </div>
      {% endfor %}
    </div>
    <!-- Newly added item, either brand new of existing. -->
    <div style='display:inline-block' ng-repeat="item in new_items">
      <div layout='row'>
        <angular-item-overview></angular-item-overview>
      </div>
    </div>

    <!-- ======== Buttons ======== -->
    <div layout='row' layout-align='end'>
      <div class='button button-small button-gray'
          ng-click="add_new_item()">Add new item</div>
      <div class='button button-small button-gray'
          ng-click="select_item()">Add existing item</div>
      <div ng-click="reset()" class='button button-small button-gray'>
        Reset
      </div>
      <div ng-click="save()" class='button button-small button-gray'>Save</div>
    </div>
  </div>
</form>
{% endblock %}