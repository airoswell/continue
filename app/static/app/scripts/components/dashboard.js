// Generated by CoffeeScript 1.8.0
(function() {
  angular.module("worldsheet").controller("DashBoardCtrl", [
    "$scope", "Post", "Item", "Feed", "Timeline", "Alert", "InfiniteScroll", "Auth", "Album", function($scope, Post, Item, Feed, Timeline, Alert, InfiniteScroll, Auth, Album) {
      var infinite_scroll_feeds, infinite_scroll_posts, infinite_scroll_timeline;
      $scope.layout = {
        creating_new_item: false,
        display_tab: "feeds",
        show_items_search_results: false,
        loading: {
          "posts": false,
          "feeds": false,
          "timeline": false
        }
      };
      infinite_scroll_posts = new InfiniteScroll(Post);
      $scope.load_posts = function() {
        $scope.layout.loading.posts = true;
        infinite_scroll_posts.config({
          model_types: ["Post"],
          init_starts: $scope.numOfPosts
        });
        $scope.posts = infinite_scroll_posts.load($scope.posts);
        return $scope.posts.$asPromise().then(function(response) {
          infinite_scroll_posts.success_handler(response);
          return $scope.layout.loading.posts = false;
        }, function() {
          return Alert.show_msg("All posts are downloaded ...");
        });
      };
      infinite_scroll_feeds = new InfiniteScroll(Feed);
      $scope.load_feeds = function() {
        $scope.layout.loading.feeds = true;
        infinite_scroll_feeds.config({
          model_types: ["ItemEditRecord", "Post", "Item"],
          init_starts: $scope.feed_starts
        });
        $scope.feeds = infinite_scroll_feeds.load($scope.feeds);
        return $scope.feeds.$asPromise().then(function(response) {
          infinite_scroll_feeds.success_handler(response);
          return $scope.layout.loading.feeds = false;
        }, function() {
          return Alert.show_msg("All feeds are downloaded ...");
        });
      };
      infinite_scroll_timeline = new InfiniteScroll(Timeline);
      $scope.load_timeline = function() {
        $scope.layout.loading.timeline = true;
        infinite_scroll_timeline.config({
          init_starts: $scope.timeline_starts,
          model_types: ["Item", "ItemEditRecord", "ItemTransactionRecord"]
        });
        $scope.timeline = infinite_scroll_timeline.load($scope.timeline);
        return $scope.timeline.$asPromise().then(function(response) {
          infinite_scroll_timeline.success_handler(response);
          return $scope.layout.loading.timeline = false;
        }, function() {
          return Alert.show_msg("All timeline events are downloaded ...");
        });
      };
      $scope.display_tab = function(tab_name) {
        var profile, tag;
        $scope.layout.display_tab = tab_name;
        if (tab_name === "items") {
          $scope.load_first_items();
        }
        if (tab_name === "settings") {
          profile = $scope.profile;
          $scope.interested_areas_array = [];
          $scope.primary_area = profile.primary_area;
          if (profile.interested_areas.length > 0) {
            $scope.interested_areas_array = profile.interested_areas.split(",");
          }
          return $scope.interested_areas_tags = [
            (function() {
              var _i, _len, _ref, _results;
              _ref = $scope.interested_areas_array;
              _results = [];
              for (_i = 0, _len = _ref.length; _i < _len; _i++) {
                tag = _ref[_i];
                _results.push({
                  text: tag
                });
              }
              return _results;
            })()
          ][0];
        }
      };
      $scope.scroll_to_post = function(id) {
        var top;
        top = $("#post-" + id).offset().top;
        $("html, body").animate({
          scrollTop: top - 100
        });
        return true;
      };
      return $scope.change_profile_photo = function() {
        return Album.get_albums().then(function(response) {
          $scope.profile.social_account_photo = response;
          return $scope.profile.$save();
        });
      };
    }
  ]);

}).call(this);
