// Generated by CoffeeScript 1.8.0
(function() {
  angular.module("worldsheet").controller("SearchResultsCtrl", [
    "$scope", "Post", "Alert", "InfiniteScroll", function($scope, Post, Alert, InfiniteScroll) {
      var infinite_scroll_posts;
      $scope.scroll_to_post = function(id) {
        var top;
        console.log(id);
        top = $("#post-" + id).offset().top;
        $("html, body").animate({
          scrollTop: top - 100
        });
        return true;
      };
      $scope.layout = {
        loading: {
          posts: false
        }
      };
      infinite_scroll_posts = new InfiniteScroll(Post);
      return $scope.load_posts = function() {
        $scope.layout.loading.posts = true;
        infinite_scroll_posts.config({
          model_types: ["Post"],
          init_starts: $scope.init_post_num,
          extra_params: {
            q: $scope.q,
            tags: $scope.tags,
            areas: $scope.areas,
            secret_key: $scope.secret_key
          }
        });
        $scope.posts = infinite_scroll_posts.load($scope.posts);
        return $scope.posts.$asPromise().then(function(response) {
          infinite_scroll_posts.success_handler(response);
          return $scope.layout.loading.posts = false;
        }, function() {
          return Alert.show_msg("All posts are downloaded ...");
        });
      };
    }
  ]);

}).call(this);
