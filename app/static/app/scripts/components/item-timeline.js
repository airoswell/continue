// Generated by CoffeeScript 1.8.0
(function() {
  angular.module("continue").controller("itemTimelineCtrl", [
    "$scope", "InfiniteScroll", "ItemTimeline", "Alert", function($scope, InfiniteScroll, ItemTimeline, Alert) {
      var infinite_scroll_timeline;
      $scope.layout = {
        loading: {
          timeline: true
        }
      };
      $scope.$watch("item_id", function() {
        return $scope.timeline = ItemTimeline.$search({
          pk: $scope.item_id,
          num_of_records: 0
        }).$then(function(response) {
          return $scope.layout.loading.timeline = false;
        });
      });
      infinite_scroll_timeline = new InfiniteScroll(ItemTimeline);
      return $scope.load_timeline = function() {
        $scope.layout.loading.timeline = true;
        infinite_scroll_timeline.config({
          init_starts: $scope.init_starts,
          model_types: ["ItemEditRecord", "ItemTransactionRecord"],
          extra_params: {
            num_of_records: 8
          }
        });
        $scope.timeline = infinite_scroll_timeline.load($scope.timeline);
        return $scope.timeline.$asPromise().then(function(response) {
          infinite_scroll_timeline.success_handler(response);
          return $scope.layout.loading.timeline = false;
        }, function() {
          return Alert.show_msg("All timeline events are downloaded ...");
        });
      };
    }
  ]);

}).call(this);
