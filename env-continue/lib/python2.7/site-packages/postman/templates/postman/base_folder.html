{% extends "layout.html" %}
{% load url from future %}
{% load i18n postman_tags %}{% load pagination_tags %}{% comment %}
WARNING: 'pagination_tags' is a name from the django-pagination application.
For convenience, the design of this template is done with the use of that application.
Django-postman will still be working, even if that application is not installed, by providing a mock
for the template tag library.
If the real implementation is to be used, just make sure that 'pagination' is declared before 'postman'
in the INSTALLED_APPS setting.
{% endcomment %}
{% block content %}

<style type="text/css">
  #postman {
    padding: 20px;
  }

  .message-list{
    font-size: 18px;background: #f9f9f9;box-shadow: 0px 2px 8px #ddd;
  }
  .message-container{
    ;
  }
  .message-container:hover{
    background: #eee;
  }
  .message-subject{
    padding: 5px 10px;font-size: 20px;
  }
  .message-subject.new{
    font-weight: 600;
  }
  .message-subject.replied{
    color: #999;
  }
  .message-body{
    color: #999;
  }
</style>

<div id="postman">
  <div class='section-title section-title-large'
      style='color:#4E85D5'>
    {% block pm_folder_title %}{% endblock %}
  </div>
  {% autopaginate pm_messages %}
  {% if invalid_page %}
  <div class='text-default'>
    {% trans "Sorry, this page number is invalid." %}
  </div>
  {% else %}
  {% if pm_messages %}

    <!-- View mode selection -->
  {% block pm_by_modes %}
    <div layout='row'>

      {% if by_message %}
      <a href="{{ by_conversation_url }}">
        <div class='text-default'>{% trans "by conversation" %}</div>
      </a>
      &nbsp;&nbsp;&nbsp;&nbsp;
      <div class="text-default">{% trans "by message"%}</div>
      {% endif %}

      {% if by_conversation %}
      <div class="text-default">
        Messages are organized by conversations.
      </div>
      <a href="{{ by_message_url }}">
        <div class="text-default">{% trans "by message" %}</div>
      </a>
      &nbsp;&nbsp;&nbsp;&nbsp;
      <div class="text-default">{% trans "by conversation"%}</div>
      {% endif %}

    </div>
  {% endblock pm_by_modes %}
  <br/>

  <!-- Delete and archive button -->
  <form id="messages-manage-form"
      action="" method="post">{% csrf_token %}
  {% block pm_form_buttons %}
  <div layout='row' id="pm_buttons">

    <div class="button button-small button-gray"
        type="submit"
        onclick="document.forms['messages-manage-form'].action='{% url 'postman_delete' %}';document.forms['messages-manage-form'].submit()">
      {% trans "Delete" %}
    </div>

    &nbsp;&nbsp;&nbsp;
    <div class="button button-small button-gray"
        type="submit"
        onclick="document.forms['messages-manage-form'].action='{% url 'postman_archive' %}';document.forms['messages-manage-form'].submit()">
      {% trans "Archive" %}
    </div>
    &nbsp;&nbsp;&nbsp;
    <div class="button button-small button-gray"
        type="submit"
        onclick="document.forms['messages-manage-form'].action='{% url 'postman_undelete' %}';document.forms['messages-manage-form'].submit()">
      {% trans "Undelete" %}
    </div>
  </div>
  {% endblock pm_form_buttons %}

  <!-- Header -->

  <br/>
  <div flex layout='row'>
    <div class='text-large' flex="5"></div>
    <div class='text-large' flex="15"
        layout='row' layout-align='center center'>
      <a href="{% postman_order_by sender %}">
      Sender &nbsp;&nbsp;&nbsp;&nbsp;
      <i class="fa fa-sort"></i>
      </a>
    </div>
    <div class='text-large' flex="40">
      <a href="{% postman_order_by subject %}">
        Subject &nbsp;&nbsp;&nbsp;&nbsp;
      <i class="fa fa-sort"></i>
      </a>
    </div>
    <div class='text-large' flex="15"
        layout='row' layout-align='start center'>
      <a href="{% postman_order_by date %}">
        Time received &nbsp;&nbsp;&nbsp;&nbsp;
      <i class="fa fa-sort"></i>
      </a>
    </div>
  </div>
  <br/>

  <!-- Message list -->
  <div class='message-list'>
    {% for message in pm_messages %}

    <div class='message-container' layout='row'>
      <div layout='row' layout-align='center'>
        <div layout='column' layout-align='center' style='padding-left:20px;'>
          <input type="checkbox" {% if by_conversation and message.thread_id %}name="tpks" value="{{ message.thread_id }}"{% else %}name="pks" value="{{ message.pk }}"{% endif %}
          style='width:50px;text-align:center;height:50px;' />
        </div>
      </div>
      <div layout='row' layout-align='center' flex="15">
        <div layout='column' layout-align='center'>
          {{ message.obfuscated_sender|or_me:user }}
          {% if message.count %}
          ({{ message.count }})
          {% endif %}
        </div>
      </div>
      <a class='message-subject
                {% if message.is_new %} new {% endif %}
                {% if message.is_replied %} replied {% endif %}'
          href="{% if by_conversation and message.thread_id %}{% url 'postman_view_conversation' message.thread_id %}{% else %}{{message.get_absolute_url }}{% endif %}?next={{ current_url|urlencode }}"
      flex="40">
        <div reduced-padding>
          {% load postman_tags %}
          {% with message.subject|truncatewords:5 as truncated_subject %}
          <div>
            {{ truncated_subject }}
          </div>
          {% with truncated_subject|wordcount as subject_wc %}
          {% with 12|sub:subject_wc as wc %}
          {% if message.body and wc > 0 %}
          <div class='text-default message-body' >
            {{ message.body|truncatewords:wc }}
          </div>
          {% endif %}
          {% endwith %}
          {% endwith %}
          {% endwith %}
        </div>
      </a>
      <div layout='row' flex="10">
        <div layout='column' layout-align='center'>
          {{ message.sent_at|compact_date:_("g:i A,M j,n/j/y") }}
        </div>
      </div>
    </div>

    {% endfor %}
  </div>

  </form>

  {% paginate %}
  {% else %}

  <div class='text-large'>{% trans "No messages." %}</div>
  {% endif %}
  {% endif %}
  {% block pm_footer_info %}{% endblock %}
</div>

{% endblock content %}